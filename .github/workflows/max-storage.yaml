name: Build Kiwi Next
on: push
# on: [workflow_call]


jobs:
  build:
    name: Build Kiwi Next
    timeout-minutes: 1200
    runs-on: self-hosted
    
    strategy:
      fail-fast: false
      max-parallel: 1
      matrix:
        platform: [arm]
        # platform: [arm, arm64, x86, x64]
    
    steps:
      - name: CI workflow device configuration
        run: |
          df -h
          uname -a
          lscpu
          free -h

      - name: Check out files
        run: |
          export PATH="$PATH:$GITHUB_WORKSPACE/depot_tools"  # TODO: fix
          cd $GITHUB_WORKSPACE/chromium/src
          
          ls out/Default
          ls out/Default/bin/chrome_public_apk
      
      - name: Free space check
        run: |
          echo "Free space:"
          df -h
      
      - name: Upload artefacts
        uses: actions/upload-artifact@v3
        with:
          name: Kiwi APK build
          path: out/Default/bin/
          retention-days: 7
